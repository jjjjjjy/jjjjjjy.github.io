+++
date = '2025-11-15T16:16:27+08:00'
draft = false
title = '防抖和节流'
+++

##### 防抖 = 把一段时间内的多次触发，压缩成“最后一次”
##### 节流 = 给事件加一个“时间闸门”，按固定频率放行
###### requestAnimationFrame 是以帧为单位的节流




防抖是指在事件触发一段时间后才执行，如果期间再次触发会重新计时；
节流是在一段时间内只允许函数执行一次，无论事件触发多少次。
防抖关注的是“只执行最后一次”，
节流关注的是“限制执行频率”，
前者压缩事件，后者采样事件。


------
##### 为什么 scroll 用节流不用防抖？
###### scroll 过程中需要持续反馈，防抖只在结束后执行一次，会造成卡顿

------

##### 为什么“防抖会破坏交互，而节流不会”
###### 判断依据是用户是否关心“过程中的状态变化”。

**用户如果不关心过程，就可以用防抖。** 防抖适合输入框搜索、表单校验、resize；

用户如果关心过程，就需要用节流。节流适合 scroll、mousemove、拖拽、曝光统计。



### requestAnimationFrame
#### 基础概念及相关概念
- requestAnimationFrame (简称 rAF) 是以浏览器帧率为单位的节流，由浏览器主导的，保证每一帧最多执行一次，并与渲染同步的 JS 执行钩子。
- 帧：屏幕被“画”一次




- rAF的核心
    - 一帧只调用一次，每次屏幕刷新前调用
    - 自动节流，tab 不可见时几乎不执行
    - 与渲染同步，回调发生在浏览器绘制前
    - 时间戳稳定，用于计算动画进度


#### 浏览器一帧里发生了什么？
1. 处理输入事件（click、scroll）
2. 执行 JS
   - setTimeout
   - Promise
   - requestAnimationFrame ← 在这里
3. 样式计算（Recalculate Style）
4. 布局（Layout / Reflow）
5. 绘制（Paint）
6. 合成（Composite）

